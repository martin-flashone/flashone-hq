<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlashOne HQ</title>

  <!-- Google Identity Services (replaces Firebase Auth for iOS WebKit compat) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #0f0f0f;
      --surface:   #1a1a1a;
      --surface2:  #242424;
      --border:    #2e2e2e;
      --text:      #e5e5e5;
      --muted:     #737373;
      --amber:     #f59e0b;
      --amber-dim: #92400e;
      --green:     #22c55e;
      --yellow:    #eab308;
      --red:       #ef4444;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      line-height: 1.5;
    }

    /* â”€â”€ AUTH SPLASH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #splash {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 1.5rem;
      padding: 2rem;
    }
    .splash-logo { font-size: 2.5rem; font-weight: 800; color: var(--amber); letter-spacing: -1px; }
    .splash-sub  { color: var(--muted); font-size: 0.95rem; }
    #sign-in-btn {
      background: var(--amber);
      color: #000;
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.15s;
    }
    #sign-in-btn:hover { opacity: 0.85; }
    #auth-error { display: none; color: var(--red); font-size: 0.875rem; text-align: center; max-width: 320px; }

    /* â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #dashboard { display: none; }

    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo         { font-size: 1.25rem; font-weight: 800; color: var(--amber); }
    .header-right { display: flex; align-items: center; gap: 1rem; }
    #user-email   { font-size: 0.8rem; color: var(--muted); }
    #sign-out-btn {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.35rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    #sign-out-btn:hover { border-color: var(--amber); }

    main {
      max-width: 960px;
      margin: 0 auto;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* â”€â”€ WARNING BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #rate-warning {
      display: none;
      background: #451a03;
      border: 1px solid var(--amber-dim);
      color: var(--amber);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; }
    .card-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 1rem;
    }
    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .card-header .card-title { margin-bottom: 0; }
    .card-meta { font-size: 0.72rem; color: var(--muted); }

    /* â”€â”€ RATE LIMIT TRACKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .rate-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
      margin-bottom: 1.25rem;
    }
    @media (max-width: 500px) { .rate-grid { grid-template-columns: 1fr; } }
    .rate-item label { font-size: 0.85rem; color: var(--muted); display: block; margin-bottom: 0.5rem; }
    .bar-track  { background: var(--surface2); border-radius: 99px; height: 10px; overflow: hidden; margin-bottom: 0.4rem; }
    .bar-fill   { height: 100%; border-radius: 99px; transition: width 0.4s ease, background 0.3s; width: 0%; }
    .bar-fill.ok      { background: var(--green); }
    .bar-fill.warning { background: var(--yellow); }
    .bar-fill.danger  { background: var(--red); }
    .rate-row  { display: flex; align-items: center; gap: 0.75rem; }
    .pct-label { font-size: 0.85rem; font-weight: 600; min-width: 36px; }
    .rate-input {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 6px;
      padding: 0.3rem 0.5rem;
      font-size: 0.85rem;
      width: 70px;
    }
    .rate-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 0.75rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .last-updated { font-size: 0.75rem; color: var(--muted); }
    .update-btn {
      background: var(--amber);
      color: #000;
      border: none;
      padding: 0.4rem 1rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
    }
    .update-btn:hover { opacity: 0.85; }
    .legend     { display: flex; gap: 1rem; font-size: 0.75rem; color: var(--muted); margin-top: 0.5rem; }
    .legend span { display: flex; align-items: center; gap: 0.3rem; }
    .dot        { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .dot.ok     { background: var(--green); }
    .dot.warning { background: var(--yellow); }
    .dot.danger { background: var(--red); }

    /* â”€â”€ PROJECT STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; }
    .status-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 1rem; }
    .status-card .s-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 0.35rem; }
    .status-card .s-sub   { font-size: 0.75rem; color: var(--muted); margin-bottom: 0.75rem; }

    /* â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .badge {
      display: inline-block;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 0.2rem 0.6rem;
      border-radius: 99px;
    }
    .badge.in-progress  { background: #1c3a5e; color: #60a5fa; }
    .badge.not-started  { background: #1f1f1f; color: var(--muted); }
    .badge.done         { background: #14532d; color: #4ade80; }
    .badge.blocked      { background: #3b1010; color: #f87171; }

    /* â”€â”€ ACTIVE TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .task-list { display: flex; flex-direction: column; gap: 0.6rem; }
    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.65rem 0.75rem;
      background: var(--surface2);
      border-radius: 8px;
      font-size: 0.875rem;
    }
    .task-item .t-badge { flex-shrink: 0; margin-top: 1px; }
    .task-item .t-text  { flex: 1; }
    .task-item .t-note  { font-size: 0.75rem; color: var(--muted); margin-top: 0.2rem; }

    /* â”€â”€ WORK LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .log-item {
      padding: 0.85rem 1rem;
      background: var(--surface2);
      border-radius: 10px;
      border-left: 3px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .log-item + .log-item { margin-top: 0.6rem; }
    .log-meta  { display: flex; align-items: center; gap: 0.6rem; flex-wrap: wrap; }
    .log-date  { font-size: 0.72rem; color: var(--muted); }
    .log-task  { font-size: 0.9rem; font-weight: 500; }
    .log-notes { font-size: 0.78rem; color: var(--muted); }
    .log-status { margin-top: 0.25rem; }

    .log-cat {
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      padding: 0.15rem 0.45rem;
      border-radius: 4px;
    }
    .cat-infra   { background: #1e1b4b; color: #a5b4fc; }
    .cat-qa      { background: #1c3a5e; color: #60a5fa; }
    .cat-content { background: #3b2f10; color: #fbbf24; }
    .cat-social  { background: #1a2e1a; color: #4ade80; }
    .cat-other   { background: #1f1f1f; color: var(--muted); }

    /* â”€â”€ QUICK LINKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .links-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem; }
    .quick-link {
      display: block;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      text-decoration: none;
      color: var(--text);
      font-size: 0.875rem;
      font-weight: 500;
      transition: border-color 0.15s;
    }
    .quick-link:hover { border-color: var(--amber); color: var(--amber); }
    .quick-link .ql-label { font-size: 0.7rem; color: var(--muted); display: block; margin-top: 0.2rem; font-weight: 400; }
  </style>
</head>
<body>

  <!-- AUTH SPLASH -->
  <div id="splash">
    <div class="splash-logo">âš¡ FlashOne HQ</div>
    <div class="splash-sub">Project dashboard â€” private access only</div>
    <button id="sign-in-btn">Sign in with Google</button>
    <div id="auth-error"></div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard">
    <header>
      <div class="logo">âš¡ FlashOne HQ</div>
      <div class="header-right">
        <span id="user-email"></span>
        <button id="sign-out-btn">Sign out</button>
      </div>
    </header>

    <main>

      <!-- WARNING BANNER -->
      <div id="rate-warning"></div>

      <!-- CLAUDE RATE LIMIT TRACKER -->
      <div class="card">
        <div class="card-title">ðŸ¤– Claude Rate Limit Tracker</div>
        <div class="rate-grid">
          <div class="rate-item">
            <label>Session Rate Limit</label>
            <div class="bar-track"><div class="bar-fill ok" id="session-bar"></div></div>
            <div class="rate-row">
              <span class="pct-label" id="session-pct-label">0%</span>
              <input class="rate-input" id="session-input" type="number" min="0" max="100" placeholder="%" />
            </div>
          </div>
          <div class="rate-item">
            <label>Weekly Rate Limit</label>
            <div class="bar-track"><div class="bar-fill ok" id="weekly-bar"></div></div>
            <div class="rate-row">
              <span class="pct-label" id="weekly-pct-label">0%</span>
              <input class="rate-input" id="weekly-input" type="number" min="0" max="100" placeholder="%" />
            </div>
          </div>
        </div>
        <div class="legend">
          <span><span class="dot ok"></span> &lt;50% Good</span>
          <span><span class="dot warning"></span> 50â€“70% Watch</span>
          <span><span class="dot danger"></span> &gt;70% Pause</span>
        </div>
        <div class="rate-footer">
          <span class="last-updated">Last updated: <span id="rate-last-updated">Never</span></span>
          <button class="update-btn" id="update-rates-btn">Update</button>
        </div>
      </div>

      <!-- PROJECT STATUS -->
      <div class="card">
        <div class="card-title">ðŸ“Š Project Status</div>
        <div class="status-grid">
          <div class="status-card">
            <div class="s-title">App Exploration</div>
            <div class="s-sub">Full navigation map, study modes, deck creation</div>
            <span class="badge done">Done</span>
          </div>
          <div class="status-card">
            <div class="s-title">QA Test Plan</div>
            <div class="s-sub">7 test profiles, bug tracker, app map</div>
            <span class="badge done">Done</span>
          </div>
          <div class="status-card">
            <div class="s-title">Project Dashboard</div>
            <div class="s-sub">Firebase hosting, auth gate, work log</div>
            <span class="badge done">Done</span>
          </div>
          <div class="status-card">
            <div class="s-title">Google Auth</div>
            <div class="s-sub">Google Identity Services (bypasses Firebase Auth)</div>
            <span class="badge done">Done</span>
          </div>
          <div class="status-card">
            <div class="s-title">Demo Content</div>
            <div class="s-sub">Repeatable demo for YouTube</div>
            <span class="badge not-started">Not Started</span>
          </div>
          <div class="status-card">
            <div class="s-title">Social Media</div>
            <div class="s-sub">Instagram, X, Facebook setup</div>
            <span class="badge not-started">Not Started</span>
          </div>
        </div>
      </div>

      <!-- ACTIVE TASKS -->
      <div class="card">
        <div class="card-title">âœ… Task Queue</div>
        <div class="task-list">

          <div class="task-item">
            <span class="badge done t-badge">Done</span>
            <div class="t-text">
              Google Auth â€” replaced Firebase Auth with Google Identity Services
              <div class="t-note">Bypasses all iOS WebKit / Firebase popup/redirect issues</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge not-started t-badge">Queued</span>
            <div class="t-text">
              Set up social media accounts (Instagram, X, Facebook)
              <div class="t-note">For FlashOne brand presence</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge not-started t-badge">Queued</span>
            <div class="t-text">
              Set up Apple ID test accounts (3 tiers: Free, Premium, Pro)
              <div class="t-note">For iOS auth testing</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge not-started t-badge">Queued</span>
            <div class="t-text">
              Build demo content + YouTube script
              <div class="t-note">Repeatable study flow for marketing</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge not-started t-badge">Queued</span>
            <div class="t-text">
              Social media strategy â€” student outreach
              <div class="t-note">Find students who need study help, send curated flashcard decks</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge not-started t-badge">Queued</span>
            <div class="t-text">
              Access app code repo (dev branch)
              <div class="t-note">Waiting for Sunny to share access</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge done t-badge">Done</span>
            <div class="t-text">
              GitHub repo setup (martin-flashone/flashone-hq, private)
              <div class="t-note">SSH, PAT, gh CLI, professional branch/PR workflow</div>
            </div>
          </div>

          <div class="task-item">
            <span class="badge done t-badge">Done</span>
            <div class="t-text">
              FlashOne app deep exploration + QA plan
              <div class="t-note">All 5 tabs mapped, 7 test profiles, bug tracker created</div>
            </div>
          </div>

        </div>
      </div>

      <!-- MARTIN'S WORK LOG -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">ðŸ“‹ Martin's Work Log</div>
          <div class="card-meta">Updated: <span id="log-last-updated">Loadingâ€¦</span></div>
        </div>
        <div id="work-log-list">
          <div class="log-item" style="color:var(--muted); font-size:0.875rem;">Loadingâ€¦</div>
        </div>
      </div>

      <!-- QUICK LINKS -->
      <div class="card">
        <div class="card-title">ðŸ”— Quick Links</div>
        <div class="links-grid">
          <a class="quick-link" href="https://app.flashone.ai/app/" target="_blank">
            FlashOne Web App
            <span class="ql-label">app.flashone.ai/app/</span>
          </a>
          <a class="quick-link" href="https://flashone.ai" target="_blank">
            Marketing Site
            <span class="ql-label">flashone.ai</span>
          </a>
          <a class="quick-link" href="https://get.flashone.ai" target="_blank">
            Funnel
            <span class="ql-label">get.flashone.ai</span>
          </a>
          <a class="quick-link" href="https://github.com/martin-flashone/flashone-hq" target="_blank">
            GitHub Repo
            <span class="ql-label">martin-flashone/flashone-hq</span>
          </a>
          <a class="quick-link" href="https://console.firebase.google.com/project/flashone-hq" target="_blank">
            Firebase Console
            <span class="ql-label">flashone-hq project</span>
          </a>
          <a class="quick-link" href="https://console.anthropic.com" target="_blank">
            Anthropic Console
            <span class="ql-label">Check rate limits</span>
          </a>
        </div>
      </div>

    </main>
  </div>

  <script>
    var GIS_CLIENT_ID = '134997614663-oubo37efttigbdpej7kfjq2f0gp5hqas.apps.googleusercontent.com';

    var ALLOWED_EMAILS = [
      'sunshine@bravefireandice.com',
      'proflashone@gmail.com'
    ];

    // Decode JWT payload (no verification needed â€” GIS signs it)
    function decodeJwtPayload(token) {
      var base64 = token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/');
      return JSON.parse(atob(base64));
    }

    function handleCredentialResponse(response) {
      var payload = decodeJwtPayload(response.credential);
      var email = payload.email;

      if (ALLOWED_EMAILS.indexOf(email) === -1) {
        showAuth();
        document.getElementById('auth-error').textContent =
          'Access denied for ' + email + '. This dashboard is private.';
        document.getElementById('auth-error').style.display = 'block';
        return;
      }

      // Store session
      sessionStorage.setItem('flashone_user', JSON.stringify({
        email: email,
        name: payload.name || email,
        picture: payload.picture || '',
        exp: payload.exp
      }));

      hideSplash();
      document.getElementById('user-email').textContent = email;
      loadDashboard();
    }

    function showAuth() {
      document.getElementById('splash').style.display = 'flex';
      document.getElementById('dashboard').style.display = 'none';
    }
    function hideSplash() {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('dashboard').style.display = 'block';
    }

    // Check existing session on page load
    function checkSession() {
      var stored = sessionStorage.getItem('flashone_user');
      if (stored) {
        var user = JSON.parse(stored);
        // Check if token has expired
        if (user.exp && (user.exp * 1000) > Date.now()) {
          hideSplash();
          document.getElementById('user-email').textContent = user.email;
          loadDashboard();
          return;
        }
        // Expired â€” clear and show login
        sessionStorage.removeItem('flashone_user');
      }
      showAuth();
    }

    // Initialize GIS when library loads
    function initGIS() {
      google.accounts.id.initialize({
        client_id: GIS_CLIENT_ID,
        callback: handleCredentialResponse
      });
      // Render the Google button in place of our custom button
      var signInBtn = document.getElementById('sign-in-btn');
      signInBtn.style.display = 'none';
      var gBtnContainer = document.createElement('div');
      gBtnContainer.id = 'g-btn-container';
      signInBtn.parentNode.insertBefore(gBtnContainer, signInBtn.nextSibling);
      google.accounts.id.renderButton(gBtnContainer, {
        theme: 'filled_black',
        size: 'large',
        text: 'signin_with',
        shape: 'pill',
        width: 250
      });
    }

    // Wait for GIS library to load, then init
    function waitForGIS() {
      if (typeof google !== 'undefined' && google.accounts) {
        initGIS();
        checkSession();
      } else {
        setTimeout(waitForGIS, 100);
      }
    }
    waitForGIS();

    document.getElementById('sign-out-btn').addEventListener('click', function() {
      sessionStorage.removeItem('flashone_user');
      google.accounts.id.disableAutoSelect();
      showAuth();
    });

    function loadDashboard() {
      loadRateLimits();
      loadWorkLog();
    }

    // â”€â”€ Rate Limit Tracker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadRateLimits() {
      var sessionPct = parseInt(localStorage.getItem('session_rate_pct') || '0');
      var weeklyPct  = parseInt(localStorage.getItem('weekly_rate_pct')  || '0');
      var lastUpdated = localStorage.getItem('rate_last_updated') || 'Never';
      setRateLimit('session', sessionPct);
      setRateLimit('weekly',  weeklyPct);
      document.getElementById('rate-last-updated').textContent = lastUpdated;
      checkWarnings(sessionPct, weeklyPct);
    }

    function setRateLimit(type, pct) {
      var bar   = document.getElementById(type + '-bar');
      var label = document.getElementById(type + '-pct-label');
      var input = document.getElementById(type + '-input');
      pct = Math.min(100, Math.max(0, pct));
      bar.style.width = pct + '%';
      bar.className = 'bar-fill ' + (pct >= 70 ? 'danger' : pct >= 50 ? 'warning' : 'ok');
      label.textContent = pct + '%';
      if (input) input.value = pct;
    }

    function checkWarnings(sessionPct, weeklyPct) {
      var banner = document.getElementById('rate-warning');
      if (sessionPct >= 70 || weeklyPct >= 70) {
        var msgs = [];
        if (sessionPct >= 70) msgs.push('Session at ' + sessionPct + '%');
        if (weeklyPct  >= 70) msgs.push('Weekly at ' + weeklyPct + '%');
        banner.textContent = '\u26A0\uFE0F Rate limit warning: ' + msgs.join(' \u00B7 ') + ' \u2014 pausing heavy tasks.';
        banner.style.display = 'block';
      } else {
        banner.style.display = 'none';
      }
    }

    document.getElementById('update-rates-btn').addEventListener('click', function() {
      var sessionPct = parseInt(document.getElementById('session-input').value || '0');
      var weeklyPct  = parseInt(document.getElementById('weekly-input').value  || '0');
      localStorage.setItem('session_rate_pct',  sessionPct);
      localStorage.setItem('weekly_rate_pct',   weeklyPct);
      var now = new Date().toLocaleString();
      localStorage.setItem('rate_last_updated', now);
      document.getElementById('rate-last-updated').textContent = now;
      setRateLimit('session', sessionPct);
      setRateLimit('weekly',  weeklyPct);
      checkWarnings(sessionPct, weeklyPct);
    });

    // â”€â”€ Work Log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadWorkLog() {
      var container = document.getElementById('work-log-list');
      var lastUpdatedEl = document.getElementById('log-last-updated');
      fetch('/work-log.json?t=' + Date.now())
        .then(function(res) { return res.json(); })
        .then(function(data) {
          if (data.lastUpdated) {
            var d = new Date(data.lastUpdated);
            lastUpdatedEl.textContent = d.toLocaleString('en-US', {
              month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit',
              hour12: true, timeZoneName: 'short'
            });
          }

          container.innerHTML = '';
          var entries = data.entries.slice().reverse(); // newest first
          entries.forEach(function(entry) {
            var div = document.createElement('div');
            div.className = 'log-item';
            var catColor = {
              infrastructure: 'cat-infra',
              qa:             'cat-qa',
              content:        'cat-content',
              social:         'cat-social',
              other:          'cat-other'
            }[entry.category] || 'cat-other';

            div.innerHTML =
              '<div class="log-meta">' +
                '<span class="log-date">' + entry.date + ' \u00B7 ' + entry.time + '</span>' +
                '<span class="log-cat ' + catColor + '">' + entry.category + '</span>' +
              '</div>' +
              '<div class="log-task">' + entry.task + '</div>' +
              (entry.notes ? '<div class="log-notes">' + entry.notes + '</div>' : '') +
              '<span class="badge ' + (entry.status === 'done' ? 'done' : entry.status === 'in-progress' ? 'in-progress' : 'not-started') + ' log-status">' +
                (entry.status === 'done' ? '\u2713 Done' : entry.status === 'in-progress' ? '\u26A1 In Progress' : '\u25CB Queued') +
              '</span>';
            container.appendChild(div);
          });
        })
        .catch(function() {
          container.innerHTML = '<div class="log-item" style="color:var(--muted)">Could not load work log.</div>';
        });
    }

  </script>
</body>
</html>
